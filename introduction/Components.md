# 组件

SeaweedFS包括3个主要概念组件。主服务和卷服务一起提供分布式对象存储，具有用户可配置的复制和冗余。可选的文件管理器和 S3 服务是对象存储区上面的附加层。这些服务中的每一个都可以作为一个或单独的实例在各种实际服务器上运行。

## 主服务

最基本的主服务是智能工作的，而不是死板的。

    它由 1 个（或 3 个或更多服务器）组成的集群，这些服务器拥有整个 SeaweedFS 集群的一致视图，并通过通过 Raft 算法选出的领导者将其传达给所有参与节点。**主服务中的服务器数量必须始终为奇数**，以确保可以形成多数共识。你最好保持这个数字，少量的稳定服务器比一大堆的主服务更好，1 或 3 是典型的。

    领导者是通过定期的筏式选举从所有可用的主服务器中任意选择的。它分配文件 ID，指定要在其中存储对象的卷，并且还有权决定哪些节点是群集的一部分。

    SeaweedFS 中的所有其他卷服务器都将检测信号发送给领导者，领导者使用它们来决定将流量路由到何处以及如何处理复制。**如果领导者不可用，raft共识协议确保在自动整个集群的同意下任命新的领导者**，并且现有缺席的领导者将被降级，直到它能够再次正常运行。

## 卷服务

卷服务是完成艰苦工作的地方。

它将许多对象（文件和文件块）有效地打包到更大的单个卷中，这些卷可以是磁盘上任意大的块。数据的冗余和复制是在卷级别管理的，而不是在每个对象级别上进行管理的。

每个卷服务器通过主服务器将带有状态和卷信息的定期检测信号发送回领导者。

## 文件管理器服务

可选的文件管理器服务可以执行繁重的工作，因此您不必做这些杂活。

它通过 HTTP 或 UNIX FUSE 挂载将 SeaweedFS 卷和对象组织到用户可见的路径（如 URL 或文件系统）中。

Filer 提供了一个方便且通用的抽象，可用于向现有应用程序提供外观正常的文件系统或 Web API，以便进行关闭/上传，而无需修改。

## S3 服务

此可选服务提供 AWS 样式的 S3 存储桶，类似于文件管理器服务。它可以单独启动，也可以与文件管理器一起启动。

## 卷的概念

SeaweedFS 中的卷意味着单个实际文件由许多小文件组成。当 master 启动时，它会配置卷文件大小，默认为 30GB。开始时，创建了 8 个卷。

每个卷都有自己的 TTL 和复制。

## 集合的概念

一个集合基本上是一组卷。最初，如果集合中不存在卷，则将会自动创建卷。

TTL 和复制选项适用于每个卷，而不是集合。一个集合可以具有不同 TTL 或复制选项的卷。

可以快速删除集合，因为它只是简单地删除集合中的所有卷。

如果要使用 S3 服务，每个存储桶都有一个专用集合。因此，移除存储桶的速度也很快。

由于一个集合需要有多个卷，并且默认情况下每个卷为 30GB，因此磁盘空间可能会很快用完。您可以将卷大小减小到 1GB 或 512MB，以解决此限制。
